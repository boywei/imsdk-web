{"remainingRequest":"/Users/wei/IdeaProjects/boywei/imsdk-web/Demo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wei/IdeaProjects/boywei/imsdk-web/Demo/src/components/message/merger-message/message-relay.vue?vue&type=style&index=0&id=f8bdc7f0&lang=stylus&scoped=true&","dependencies":[{"path":"/Users/wei/IdeaProjects/boywei/imsdk-web/Demo/src/components/message/merger-message/message-relay.vue","mtime":1648707124000},{"path":"/Users/wei/IdeaProjects/boywei/imsdk-web/Demo/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/wei/IdeaProjects/boywei/imsdk-web/Demo/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/wei/IdeaProjects/boywei/imsdk-web/Demo/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/wei/IdeaProjects/boywei/imsdk-web/Demo/node_modules/stylus-loader/index.js","mtime":1519606876000},{"path":"/Users/wei/IdeaProjects/boywei/imsdk-web/Demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wei/IdeaProjects/boywei/imsdk-web/Demo/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.conversation-container {\n    position absolute\n    top 0\n    left 0\n    right 0\n    width 80%\n    margin auto\n    background-color #fff\n    z-index 999\n}\n.conversation-list-btn {\n    width 140px\n    display flex\n    float right\n    margin 10px 0\n    .conversation-btn {\n        cursor pointer\n        padding 6px 12px\n        background #00A4FF\n        color #ffffff\n        font-size 14px\n        border-radius 20px\n        margin-left 13px\n    }\n}\n",{"version":3,"sources":["message-relay.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"message-relay.vue","sourceRoot":"src/components/message/merger-message","sourcesContent":["<template>\n    <div class=\"chat-bubble\" @mousedown.stop @contextmenu.prevent>\n        <div class=\"conversation-container\">\n            <ConversationSelectedList   @getList=\"getList\"></ConversationSelectedList>\n            <div class=\"conversation-list-btn\">\n                <span class=\"conversation-btn\" @click=\"cancel\">取消</span>\n                <span class=\"conversation-btn\" @click=\"messageRelay\">发送</span>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\n  import { mapState } from 'vuex'\n  import ConversationSelectedList from '../../conversation/conversation-selected-list'\n\n  export default {\n    name: 'MessageBubble',\n    components: {\n      ConversationSelectedList\n    },\n    data() {\n      return {\n        isTimeout: false,\n        showConversationList: false,\n        selectedConversation: [],\n        testMergerMessage: {}\n      }\n    },\n    created() {\n    },\n    mounted() {\n      if (this.$refs.dropdown && this.$refs.dropdown.$el) {\n        this.$refs.dropdown.$el.addEventListener('mousedown', this.handleDropDownMousedown)\n      }\n    },\n    beforeDestroy() {\n      if (this.$refs.dropdown && this.$refs.dropdown.$el) {\n        this.$refs.dropdown.$el.removeEventListener('mousedown', this.handleDropDownMousedown)\n      }\n    },\n    updated() {\n    },\n    computed: {\n      ...mapState({\n        isShowConversationList: state => state.conversation.isShowConversationList,\n        selectedMessageList: state => state.conversation.selectedMessageList,\n        relayType: state => state.conversation.relayType,\n        relayMessage: state => state.conversation.relayMessage\n      }),\n    },\n    methods: {\n      cancel() {\n        this.$store.commit('showConversationList', false)\n      },\n      getList(value) {\n        this.selectedConversation = value\n\n      },\n      sendSingleMessage(to, type, message) {\n        const _message = this.tim.createForwardMessage({\n          to: to,\n          conversationType: type,\n          payload: message,\n          priority: this.TIM.TYPES.MSG_PRIORITY_NORMAL\n        })\n        this.$store.commit('pushCurrentMessageList', _message)   // ??\n        return _message\n      },\n      mergerSort() {\n        this.selectedMessageList.sort((a, b) =>  {\n          if(a.time !== b.time) {\n            return a.time - b.time\n          }else {\n            return a.sequence - b.sequence\n          }\n        })\n      },\n      mergerMessage(to, type) {\n        let _abstractList = [], _count = 0, _title = ''\n        _count = this.selectedMessageList.length < 3 ? this.selectedMessageList.length : 3\n\n        for(let i = 0; i < _count; i++) {\n          _abstractList.push(this.setAbstractList(this.selectedMessageList[i]))\n        }\n        _title = this.selectedMessageList[0].conversationType === 'GROUP' ? '群聊的聊天记录' : `${this.selectedMessageList[0].nick || this.selectedMessageList[0].from} 和 ${this.selectedMessageList[0].to} 的聊天记录`\n        let message = this.tim.createMergerMessage({\n          to: to,\n          conversationType: type,\n          payload: {\n            messageList: this.selectedMessageList ,\n            title: _title,\n            abstractList: _abstractList,\n            compatibleText: '请升级IMSDK到v2.10.1或更高版本查看此消息'\n          }\n        })\n        this.$store.commit('pushCurrentMessageList', message)   // ??\n        return message\n      },\n      async messageRelay() {\n        let _type = '', _to = ''\n        for (let item of this.selectedConversation) {\n          if(item.indexOf(this.TIM.TYPES.CONV_C2C) !== -1) {\n            _type = this.TIM.TYPES.CONV_C2C\n            _to = item.substring(3, item.length)\n          }\n          if(item.indexOf(this.TIM.TYPES.CONV_GROUP) !== -1) {\n            _type = this.TIM.TYPES.CONV_GROUP\n            _to = item.substring(5, item.length)\n          }\n          // 排序\n          this.mergerSort()\n          if (this.relayType === 1) {\n            let message = this.sendSingleMessage(_to, _type, this.relayMessage)\n            this.sendMessageHandler(message)\n          }\n\n          if (this.relayType === 2) {\n            if(this.selectedMessageList.length > 30) {\n              this.$store.commit('showMessage', {\n                message: '转发消息仅支持30条以内',\n                type: 'error'\n              })\n              return\n            }\n            for (let selectedMessage of this.selectedMessageList) {\n              let message = await this.sendSingleMessage(_to, _type, selectedMessage)\n              await this.tim.sendMessage(message)\n                .then((res) => {\n                  return res\n                })\n                .catch(imError => {\n                  this.$store.commit('showMessage', {\n                    message: imError.message,\n                    type: 'error'\n                  })\n                })\n\n            }\n          }\n          if (this.relayType === 3) {\n            let message = this.mergerMessage(_to, _type)\n            this.sendMessageHandler(message)\n          }\n        }\n        this.$store.commit('showConversationList', false)\n        this.$store.commit('resetSelectedMessage', false)\n      },\n\n      sendMessageHandler(message) {\n        this.tim.sendMessage(message).catch(imError => {\n            this.$store.commit('showMessage', {\n              message: imError.message,\n              type: 'error'\n            })\n          })\n      },\n      setAbstractList(message) {\n        let nick = message.nick || message.from\n        let text = ''\n        switch (message.type) {\n          case this.TIM.TYPES.MSG_TEXT:\n            text = message.payload.text || ''\n            if (text.length > 20) {\n              text = text.slice(0, 20)\n            }\n            return `${nick}: ${text}`\n          case this.TIM.TYPES.MSG_MERGER:\n            return `${nick}: [聊天记录]`\n          case this.TIM.TYPES.MSG_IMAGE:\n            return `${nick}: [图片]`\n          case this.TIM.TYPES.MSG_AUDIO:\n            return `${nick}: [音频]`\n          case this.TIM.TYPES.MSG_VIDEO:\n            return `${nick}: [视频]`\n          case this.TIM.TYPES.MSG_CUSTOM:\n            return `${nick}: [自定义消息]`\n          case this.TIM.TYPES.MSG_FILE:\n            return `${nick}: [文件]`\n          case this.TIM.TYPES.MSG_FACE:\n            return `${nick}: [动画表情]`\n        }\n      },\n      handleDropDownMousedown(e) {\n        if (e.buttons === 2) {\n          if (this.$refs.dropdown.visible) {\n            this.$refs.dropdown.hide()\n          } else {\n            this.$refs.dropdown.show()\n          }\n        }\n      }\n    }\n  }\n</script>\n\n<style lang=\"stylus\" scoped>\n    .conversation-container {\n        position absolute\n        top 0\n        left 0\n        right 0\n        width 80%\n        margin auto\n        background-color #fff\n        z-index 999\n    }\n    .conversation-list-btn {\n        width 140px\n        display flex\n        float right\n        margin 10px 0\n        .conversation-btn {\n            cursor pointer\n            padding 6px 12px\n            background #00A4FF\n            color #ffffff\n            font-size 14px\n            border-radius 20px\n            margin-left 13px\n        }\n    }\n</style>\n"]}]}